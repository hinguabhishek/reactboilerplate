from connector_utils import get_connector_schemas
from models.state import ResearchState
from utils.llm import llm
import json

class SchemaAgent:
    def __init__(self):
        self.llm = llm

    def get_connector_config(self, state: ResearchState):
        connectors = state.get("task")["connectors"]
        print("connecotrs to get config", connectors)
        # connector_layout_configs = {}
        # for connector in connectors:
        #     connector_schemas = get_connector_schemas(connector)
        #     connector_layout_configs[connector] = connector_schemas
        # print(
        #     'connector_layout_configs ____________________________________________',
        #     connector_layout_configs,
        # )
        connector_layout_configs = json.loads(json.dumps({'a0n3300000FSK2zAAH': {'config': {'schema': {'$schema': 'http://json-schema.org/draft-07/schema#', '$id': 'http://example.com/schema', '$defs': {'tax_calculation': {'type': 'object', 'additionalProperties': False, 'properties': {'wc_avatax_enable_tax_calculation': {'type': 'boolean', 'default': True}, 'wc_avatax_record_calculations': {'type': 'boolean', 'default': True}, 'wc_avatax_company_code': {'type': 'string'}, 'wc_avatax_company_id': {'type': 'number'}, 'wc_avatax_shipping_code': {'type': 'string', 'default': 'FR'}}, 'required': ['wc_avatax_company_code', 'wc_avatax_company_id']}, 'address_validation': {'type': 'object', 'properties': {'wc_avatax_enable_address_validation': {'type': 'boolean', 'default': True}}}, 'exemption_certificate_management': {'type': 'object', 'properties': {'wc_avatax_enable_ecm': {'type': 'boolean', 'default': True}}}, 'transactions_outside_the_us': {'type': 'object', 'properties': {'wc_avatax_enable_vat': {'type': 'boolean', 'default': True}}}, 'logs': {'type': 'object', 'additionalProperties': False, 'properties': {'wc_avatax_debug': {'type': 'boolean', 'default': True}}}}, 'type': 'object', 'properties': {'tax_calculation': {'$ref': '#/$defs/tax_calculation'}, 'address_validation': {'$ref': '#/$defs/address_validation'}, 'exemption_certificate_management': {'$ref': '#/$defs/exemption_certificate_management'}, 'transactions_outside_the_us': {'$ref': '#/$defs/transactions_outside_the_us'}, 'logs': {'$ref': '#/$defs/logs'}}, 'required': ['tax_calculation']}}, 'layout': {'type': 'VerticalLayout', 'elements': [{'type': 'Control', 'label': 'Enable tax calculation', 'scope': '#/properties/wc_avatax_enable_tax_calculation'}, {'type': 'Control', 'label': 'Save transactions in Avalara for reporting', 'scope': '#/properties/wc_avatax_record_calculations'}, {'type': 'Control', 'label': 'Company name', 'scope': '#/properties/wc_avatax_company_code'}, {'type': 'Control', 'label': 'Calculate Colorado retail delivery fee', 'scope': '#/properties/wc_avatax_enable_co_rdf'}, {'type': 'Control', 'label': 'Shipping tax code', 'scope': '#/properties/wc_avatax_shipping_code'}, {'type': 'Control', 'label': 'Validate address', 'scope': '#/properties/wc_avatax_enable_address_validation'}, {'type': 'Control', 'label': 'Enable exemption certificates', 'scope': '#/properties/wc_avatax_enable_ecm'}, {'type': 'Control', 'label': 'Collect Business VAT ID', 'scope': '#/properties/wc_avatax_enable_vat'}, {'type': 'Control', 'label': 'Calculate customs duties', 'scope': '#/properties/wc_avatax_enable_cross_border_classification'}, {'type': 'Control', 'label': 'AvaTax Username', 'scope': '#/properties/wc_avatax_hs_api_username'}, {'type': 'Control', 'label': 'AvaTax password', 'scope': '#/properties/wc_avatax_hs_api_password'}, {'type': 'Control', 'label': 'Countries for HS Code assignment', 'scope': '#/properties/wc_avatax_api_product_countries_sync'}, {'type': 'Control', 'label': 'Enable logging', 'scope': '#/properties/wc_avatax_debug'}]}}, 'a0n3300000FSCNuAAP': {'config': {'$schema': 'http://json-schema.org/draft-07/schema#', '$id': 'http://example.com/schema', '$defs': {'tax_calculation_obj': {'type': 'object', 'properties': {'tax_calculation_visibility': {'type': 'boolean', 'default': True}, 'company_code': {'type': 'string', 'default': 'DEFAULT'}, 'tax_included': {'type': 'string', 'oneOf': [{'const': 'net', 'title': 'NET: Included taxes are NOT part of the catalog price and are added separately to the cart subtotal.'}, {'const': 'gross', 'title': 'GROSS: Included taxes are part of the catalog price and are not added separately to the cart subtotal.'}], 'default': ''}, 'tax_included_visibility': {'type': 'boolean', 'default': True}, 'tax_mode': {'type': 'string', 'oneOf': [{'const': '1', 'title': 'Disabled - Disables Avalara tax estimation and uses native Adobe Commerce tax estimation. Use this option when you want to use address validation only.'}, {'const': '2', 'title': 'Estimate tax - Runs Avalara tax estimation during order checkout but does NOT submit completed orders to Avalara.'}, {'const': '3', 'title': 'Estimate tax and submit transactions to Avalara (Default) - (Use Avalara to estimate tax during checkout, and submit invoices and credit memos to Avalara.)'}], 'default': '3'}, 'data_mapping': {'type': 'object', 'properties': {'shipping_tax_code': {'type': 'string', 'default': 'FR020100'}, 'avatax_adjustment_taxes': {'type': 'boolean', 'default': False}}, 'required': ['shipping_tax_code']}}, 'required': ['company_code']}, 'address_validation_obj': {'type': 'object', 'properties': {'address_validation_enabled': {'type': 'boolean', 'default': False}}}, 'transactions_outside_the_us_obj': {'type': 'object', 'properties': {'use_business_identification_number': {'type': 'boolean', 'default': False}}}, 'one_way_items_sync': {'type': 'object', 'properties': {'enabled': {'type': 'boolean', 'default': False}}}, 'exemption_certificate_management_obj': {'type': 'object', 'properties': {'enabled': {'type': 'boolean', 'default': True}}}, 'error_logs_obj': {'type': 'object', 'properties': {'error_settings_obj': {'type': 'object', 'properties': {'error_action': {'type': 'string', 'oneOf': [{'const': '1', 'title': 'Disable checkout & show error message'}, {'const': '2', 'title': 'Allow checkout & fall back to native Adobe Commerce tax calculation (no error message)'}], 'default': '2'}, 'avatax_timeout': {'type': 'string', 'default': '60'}}, 'required': ['avatax_timeout']}, 'logs_settings_obj': {'type': 'object', 'properties': {'logging_db_level': {'type': 'string', 'oneOf': [{'const': '100', 'title': 'Debug'}, {'const': '200', 'title': 'Info'}, {'const': '250', 'title': 'Notice'}, {'const': '300', 'title': 'Warning'}, {'const': '400', 'title': 'Error'}, {'const': '500', 'title': 'Critical'}], 'default': '300'}, 'logging_db_detail': {'type': 'string', 'oneOf': [{'const': '1', 'title': 'Minimal'}, {'const': '2', 'title': 'Normal'}, {'const': '3', 'title': 'Extra'}], 'default': '1'}, 'logging_db_lifetime': {'type': 'string', 'default': '180'}, 'logging_file_enabled': {'type': 'boolean', 'default': True}, 'logging_file_level': {'type': 'string', 'oneOf': [{'const': '100', 'title': 'Debug'}, {'const': '200', 'title': 'Info'}, {'const': '250', 'title': 'Notice'}, {'const': '300', 'title': 'Warning'}, {'const': '400', 'title': 'Error'}, {'const': '500', 'title': 'Critical'}], 'default': '300'}, 'logging_file_detail': {'type': 'string', 'oneOf': [{'const': '1', 'title': 'Minimal'}, {'const': '2', 'title': 'Normal'}, {'const': '3', 'title': 'Extra'}], 'default': '1'}}, 'required': ['logging_db_lifetime']}, 'queue_settings_obj': {'type': 'object', 'properties': {'queue_processing_type': {'type': 'string', 'oneOf': [{'const': 'normal', 'title': 'Normal processing (Queue processing - each item of the queue will be processed separately).'}, {'const': 'batch', 'title': 'Batch queue processing (Queue will be processed by 1000-item batch).'}], 'default': 'normal'}, 'queue_admin_notification_enabled': {'type': 'boolean', 'default': True}, 'queue_failure_notification_enabled': {'type': 'boolean', 'default': True}}}}}}, 'type': 'object', 'properties': {'tax_calculation_obj': {'$ref': '#/$defs/tax_calculation_obj'}, 'address_validation': {'$ref': '#/$defs/address_validation_obj'}, 'exemption_certificate_management': {'$ref': '#/$defs/exemption_certificate_management_obj'}, 'transactions_outside_the_us': {'$ref': '#/$defs/transactions_outside_the_us_obj'}, 'one_way_items_sync': {'$ref': '#/$defs/one_way_items_sync'}, 'error_logs_obj': {'$ref': '#/$defs/error_logs_obj'}}, 'required': ['tax_calculation_obj']}, 'layout': {'type': 'VerticalLayout', 'parent': 'true', 'description': 'The Advanced setting option in AVATAX helps you configure how you want AvaTax to calculate tax for your business.', 'options': {'ipua': {'ipuaPanel': {'panelLinkText': 'Learn how to configure', 'panelContent': '/bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html'}}}, 'elements': [{'type': 'Control', 'label': 'Tax calculation', 'scope': '#/properties/tax_calculation_obj', 'description': 'Customize shipping tax code, company name, and more options.', 'options': {'layout': 'Accordion', 'elementLabelProp': 'channel', 'ipua': {'ipuaPanel': {'panelSubText': 'Learn how to\xa0customize ', 'panelLinkText': 'tax calculation settings', 'panelContent': '/bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html#myc1716306970603__tax_calculation_settings'}}}, 'elements': [{'type': 'VerticalLayout', 'elements': [{'type': 'Control', 'label': 'Company name', 'scope': '#/properties/tax_calculation_obj/properties/company_code', 'options': {'optionList': True, 'eventListener': 'onCompanyInit'}, 'description': 'Avalara company connected to your Adobe Commerce store.'}, {'type': 'Control', 'label': 'Taxation policy (store view)', 'scope': '#/properties/tax_calculation_obj/properties/tax_included', 'options': {'format': 'radio'}, 'customRule': {'effect': 'ENABLE', 'condition': {'scope': '#/properties/tax_calculation_obj/properties/tax_included_visibility', 'schema': {'const': True}}}}, {'type': 'infoPanel', 'scope': '#', 'options': {'alert': True, 'className': 'margin-bottom-xl', 'status': 'warning', 'message': 'For tax compliance reasons, once you save the settings for the first time, you will not be able to change the <b>Taxation Policy</b> again.'}}, {'type': 'Control', 'label': 'Tax mode (store view)', 'scope': '#/properties/tax_calculation_obj/properties/tax_mode', 'description': 'Use Adobe Commerce to estimate tax. Avalara is not used to estimate tax, and no transactions are submitted to Avalara.', 'options': {'format': 'radio'}}, {'type': 'Group', 'label': 'Data mapping (store view)', 'scope': '#/properties/tax_calculation_obj/properties/data_mapping', 'elements': [{'type': 'Control', 'label': 'Shipping tax code (store view)', 'scope': '#/properties/tax_calculation_obj/properties/data_mapping/properties/shipping_tax_code', 'description': "Enter a shipping tax code for transactions at your store. If you don't enter a value, Avalara automatically assigns freight (FR) as the shipping tax code.", 'options': {'ipua': {'ipuaPanel': {'panelLinkText': 'Learn more', 'panelContent': '/bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html#myc1716306970603__shipping_tax_code'}}}}, {'type': 'Control', 'label': 'Enable tax calculation for adjustment refund and adjustment fee (store view)', 'scope': '#/properties/tax_calculation_obj/properties/data_mapping/properties/avatax_adjustment_taxes', 'description': "Set to 'Yes' to allow Avalara to calculate tax for adjustment fees and refunds. Adobe Commerce doesn't calculate taxes for adjustment fees and refunds.", 'options': {'toggle': True, 'trueStatusLabel': 'Yes', 'falseStatusLabel': 'No', 'ipua': {'ipuaPanel': {'panelLinkText': 'Learn more', 'panelContent': ' /bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html#myc1716306970603__shipping_tax_code'}}}}]}]}], 'customRule': {'effect': 'HIDE', 'condition': {'scope': '#/properties/tax_calculation_obj/properties/tax_calculation_visibility', 'schema': {'const': False}}}}, {'type': 'Control', 'scope': '#/properties/address_validation_obj', 'options': {'layout': 'Accordion', 'elementLabelProp': 'channel', 'ipua': {'ipuaPanel': {'panelSubText': 'Learn how to\xa0customize', 'panelLinkText': ' address validation setting', 'panelContent': '/bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html'}}}, 'label': 'Address validation', 'description': 'Customize the enable address validation option.', 'elements': [{'type': 'VerticalLayout', 'elements': [{'type': 'Control', 'label': 'Validate addresses (store view)', 'scope': '#/properties/address_validation_obj/properties/address_validation_enabled', 'options': {'toggle': True, 'trueStatusLabel': 'Yes', 'falseStatusLabel': 'No'}, 'description': 'Turn this on to enable the Validate addresses option. Customers can use it to validate and correct addresses in the US and Canada.'}]}], 'customRule': {'effect': 'SHOW', 'condition': {'scope': '#', 'schema': {'required': ['address_validation_obj']}}}}, {'type': 'Control', 'scope': '#/properties/exemption_certificate_management_obj', 'options': {'layout': 'Accordion', 'elementLabelProp': 'channel'}, 'label': 'Exemption certificate management', 'elements': [{'type': 'VerticalLayout', 'elements': [{'type': 'Control', 'label': 'Enable exemption certificates (store view)', 'scope': '#/properties/exemption_certificate_management_obj/properties/enabled', 'description': "Set to 'Yes' to add a link for customers to create or upload exemption certificates during checkout.", 'options': {'toggle': True, 'trueStatusLabel': 'Yes', 'falseStatusLabel': 'No', 'ipua': {'ipuaPanel': {'panelLinkText': 'Learn more', 'panelContent': '/bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html#myc1716306970603__exemption_certificate_setting'}}}}]}], 'customRule': {'effect': 'SHOW', 'condition': {'scope': '#', 'schema': {'required': ['exemption_certificate_management_obj']}}}}, {'type': 'Control', 'scope': '#/properties/transactions_outside_the_us_obj', 'options': {'layout': 'Accordion', 'elementLabelProp': 'channel'}, 'label': 'Transactions outside the US', 'elements': [{'type': 'VerticalLayout', 'elements': [{'type': 'Control', 'label': 'Business VAT ID (store view)', 'scope': '#/properties/transactions_outside_the_us_obj/properties/use_business_identification_number', 'description': "Set to 'Yes' to use Tax/VAT number value from customer record to calculate tax in Avalara. This value is sent as business identification number to Avalara.", 'options': {'toggle': True, 'trueStatusLabel': 'Yes', 'falseStatusLabel': 'No', 'ipua': {'ipuaPanel': {'panelLinkText': 'Learn more', 'panelContent': '/bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html#myc1716306970603__transactions_outside_US_setting'}}}}]}], 'customRule': {'effect': 'SHOW', 'condition': {'scope': '#', 'schema': {'required': ['transactions_outside_the_us_obj']}}}}, {'type': 'Control', 'scope': '#/properties/one_way_items_sync', 'options': {'layout': 'Accordion', 'elementLabelProp': 'channel'}, 'label': 'Product sync', 'elements': [{'type': 'VerticalLayout', 'elements': [{'type': 'Control', 'label': 'Sync products with Avalara (store view)', 'scope': '#/properties/one_way_items_sync/properties/enabled', 'options': {'toggle': True, 'trueStatusLabel': 'Yes', 'falseStatusLabel': 'No', 'ipua': {'ipuaPanel': {'panelLinkText': 'Learn more', 'panelContent': '/bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html#myc1716306970603__tax_calculation_settings'}}}, 'description': 'Synchronize your product catalog in Adobe Commerce with the catalog you configured in the Avalara Portal. This is a one-way product sync from Adobe Commerce to Avalara.'}]}, {'type': 'infoPanel', 'scope': '#', 'options': {'alert': True, 'className': 'margin-bottom-sm', 'status': 'warning', 'message': "Product sync applies only to the default company that you've configured in your AvaTax account. To sync products to a different company, change your default company in AvaTax."}, 'customRule': {'effect': 'HIDE', 'condition': {'scope': '#/properties/one_way_items_sync/properties/enabled', 'schema': {'const': False}}}}], 'customRule': {'effect': 'SHOW', 'condition': {'scope': '#', 'schema': {'required': ['one_way_items_sync']}}}}, {'type': 'Control', 'scope': '#/properties/error_logs', 'options': {'layout': 'Accordion', 'elementLabelProp': 'channel'}, 'label': 'Errors, logs, and queue', 'elements': [{'type': 'Group', 'label': 'Error handling settings', 'scope': '#/properties/error_logs_obj/properties/error_settings_obj', 'elements': [{'type': 'Control', 'label': 'Error action (store view)', 'scope': '#/properties/error_logs_obj/properties/error_settings_obj/properties/error_action', 'description': 'If there is an error when Avalara estimates tax, the extension uses Adobe Commerce tax rules. If Disable checkout and show error message is selected, the extension prevents users and admins from placing orders.', 'options': {'ipua': {'infotips': [{'parent': 'label', 'iphId': 'error_action', 'iphContent': '/bundle/ool1720100088814/page/szl1720100205873.html'}]}}}, {'type': 'Control', 'label': 'Avalara API timeout (store view)', 'scope': '#/properties/error_logs_obj/properties/error_settings_obj/properties/avatax_timeout', 'description': "Enter the waiting time in seconds for Adobe Commerce to get a response from Avalara servers before concluding they aren't responding.", 'options': {'ipua': {'ipuaPanel': {'panelLinkText': 'Learn more', 'panelContent': ' /bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html#myc1716306970603__error_settings_store'}}}}], 'customRule': {'effect': 'SHOW', 'condition': {'scope': '#/properties/error_logs_obj', 'schema': {'required': ['error_settings_obj']}}}}, {'type': 'Group', 'label': 'Logging settings', 'scope': '#/properties/error_logs_obj/properties/logs_settings_obj', 'elements': [{'type': 'Control', 'label': 'Database log level (global)', 'scope': '#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_db_level', 'description': "'Warning' is recommended if you're connected to an Avalara production account."}, {'type': 'Control', 'label': 'Database log detail (global)', 'scope': '#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_db_detail', 'description': "'Minimal' is recommended if you're connected to an Avalara production account."}, {'type': 'Control', 'label': 'Database log record lifetime (global)', 'scope': '#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_db_lifetime'}, {'type': 'Control', 'label': 'Enable logging to file (global)', 'scope': '#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_enabled', 'options': {'toggle': True, 'trueStatusLabel': 'Yes', 'falseStatusLabel': 'No'}, 'description': "Turn this on to create a log of API requests, responses, and errors for transactions. The log is saved in Adobe Commerce. It's useful when troubleshooting issues with transactions."}, {'type': 'Control', 'label': 'File log level (global)', 'scope': '#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_level', 'description': "'Warning' is recommended if you’re connected to an Avalara production account.", 'customRule': {'effect': 'HIDE', 'condition': {'scope': '#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_enabled', 'schema': {'const': False}}}}, {'type': 'Control', 'label': 'File log detail (global)', 'scope': '#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_detail', 'description': "'Normal' is recommended if you’re connected to an Avalara production account.", 'customRule': {'effect': 'HIDE', 'condition': {'scope': '#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_enabled', 'schema': {'const': False}}}}], 'customRule': {'effect': 'SHOW', 'condition': {'scope': '#/properties/error_logs_obj', 'schema': {'required': ['logs_settings_obj']}}}}, {'type': 'Group', 'label': 'Queue processing settings', 'scope': '#/properties/error_logs_obj/properties/queue_settings_obj', 'elements': [{'type': 'Control', 'label': 'Queue processing type (global) ', 'scope': '#/properties/error_logs_obj/properties/queue_settings_obj/properties/queue_processing_type', 'options': {'format': 'radio'}}, {'type': 'Control', 'label': 'Enable queue admin notification (global)', 'scope': '#/properties/error_logs_obj/properties/queue_settings_obj/properties/queue_admin_notification_enabled', 'description': 'A notification will be displayed at the top of any admin page if there are pending queue records waiting to be submitted to AvaTax but no attempts have been made in the last 24 hours to submit them.', 'options': {'toggle': True, 'trueStatusLabel': 'Yes', 'falseStatusLabel': 'No'}}, {'type': 'Control', 'label': 'Enable queue failure notification (global)', 'scope': '#/properties/error_logs_obj/properties/queue_settings_obj/properties/queue_failure_notification_enabled', 'description': 'A notification displays at the top of any admin page if there are transactions waiting to be submitted to Avalara and no attempts have been made to submit them in the last 24 hours.', 'options': {'toggle': True, 'trueStatusLabel': 'Yes', 'falseStatusLabel': 'No'}}], 'customRule': {'effect': 'SHOW', 'condition': {'scope': '#/properties/error_logs_obj', 'schema': {'required': ['queue_settings_obj']}}}}]}]}}}))
        # connector_layout_configs = json.loads(json.dumps({'a0n4000000CiXBWAA3': {'config': {"$schema":"http://json-schema.org/draft-07/schema#","$id":"http://example.com/schema","$defs":{"tax_calculation_obj":{"type":"object","properties":{"tax_calculation_visibility":{"type":"boolean","default":True},"company_code":{"type":"string","default":"DEFAULT"},"tax_included":{"type":"string","oneOf":[{"const":"net","title":"NET: Included taxes are NOT part of the catalog price and are added separately to the cart subtotal."},{"const":"gross","title":"GROSS: Included taxes are part of the catalog price and are not added separately to the cart subtotal."}],"default":""},"tax_included_visibility":{"type":"boolean","default":True},"tax_mode":{"type":"string","oneOf":[{"const":"1","title":"Disabled - Disables Avalara tax estimation and uses native Adobe Commerce tax estimation. Use this option when you want to use address validation only."},{"const":"2","title":"Estimate tax - Runs Avalara tax estimation during order checkout but does NOT submit completed orders to Avalara."},{"const":"3","title":"Estimate tax and submit transactions to Avalara (Default) - (Use Avalara to estimate tax during checkout, and submit invoices and credit memos to Avalara.)"}],"default":"3"},"data_mapping":{"type":"object","properties":{"shipping_tax_code":{"type":"string","default":"FR020100"},"avatax_adjustment_taxes":{"type":"boolean","default":False}},"required":["shipping_tax_code"]}},"required":["company_code"]},"address_validation_obj":{"type":"object","properties":{"address_validation_enabled":{"type":"boolean","default":False}}},"transactions_outside_the_us_obj":{"type":"object","properties":{"use_business_identification_number":{"type":"boolean","default":False}}},"one_way_items_sync":{"type":"object","properties":{"enabled":{"type":"boolean","default":False}}},"exemption_certificate_management_obj":{"type":"object","properties":{"enabled":{"type":"boolean","default":True}}},"error_logs_obj":{"type":"object","properties":{"error_settings_obj":{"type":"object","properties":{"error_action":{"type":"string","oneOf":[{"const":"1","title":"Disable checkout & show error message"},{"const":"2","title":"Allow checkout & fall back to native Adobe Commerce tax calculation (no error message)"}],"default":"2"},"avatax_timeout":{"type":"string","default":"60"}},"required":["avatax_timeout"]},"logs_settings_obj":{"type":"object","properties":{"logging_db_level":{"type":"string","oneOf":[{"const":"100","title":"Debug"},{"const":"200","title":"Info"},{"const":"250","title":"Notice"},{"const":"300","title":"Warning"},{"const":"400","title":"Error"},{"const":"500","title":"Critical"}],"default":"300"},"logging_db_detail":{"type":"string","oneOf":[{"const":"1","title":"Minimal"},{"const":"2","title":"Normal"},{"const":"3","title":"Extra"}],"default":"1"},"logging_db_lifetime":{"type":"string","default":"180"},"logging_file_enabled":{"type":"boolean","default":True},"logging_file_level":{"type":"string","oneOf":[{"const":"100","title":"Debug"},{"const":"200","title":"Info"},{"const":"250","title":"Notice"},{"const":"300","title":"Warning"},{"const":"400","title":"Error"},{"const":"500","title":"Critical"}],"default":"300"},"logging_file_detail":{"type":"string","oneOf":[{"const":"1","title":"Minimal"},{"const":"2","title":"Normal"},{"const":"3","title":"Extra"}],"default":"1"}},"required":["logging_db_lifetime"]},"queue_settings_obj":{"type":"object","properties":{"queue_processing_type":{"type":"string","oneOf":[{"const":"normal","title":"Normal processing (Queue processing - each item of the queue will be processed separately)."},{"const":"batch","title":"Batch queue processing (Queue will be processed by 1000-item batch)."}],"default":"normal"},"queue_admin_notification_enabled":{"type":"boolean","default":True},"queue_failure_notification_enabled":{"type":"boolean","default":True}}}}}},"type":"object","properties":{"tax_calculation_obj":{"$ref":"#/$defs/tax_calculation_obj"},"address_validation":{"$ref":"#/$defs/address_validation_obj"},"exemption_certificate_management":{"$ref":"#/$defs/exemption_certificate_management_obj"},"transactions_outside_the_us":{"$ref":"#/$defs/transactions_outside_the_us_obj"},"one_way_items_sync":{"$ref":"#/$defs/one_way_items_sync"},"error_logs_obj":{"$ref":"#/$defs/error_logs_obj"}},"required":["tax_calculation_obj"]}, 'layout': {"type":"VerticalLayout","parent":"True","description":"The Advanced settings in Avalara help you configure how you want Avalara to calculate tax for your business","options":{"configUpdateMessageContent":{"status":"warning","message":"Your configuration changes are saved successfully and will be automatically synced with Adobe Commerce after 15 minutes. To see the changes right away, select 'Sync Configuration' on the Adobe platform."},"ipua":{"ipuaPanel":{"panelLinkText":"Learn how to configure","panelContent":"/bundle/usd1665121460439_usd1665121460439/page/dxg1706093057777.html"}}},"elements":[{"type":"Control","label":"Tax calculation","scope":"#/properties/tax_calculation_obj","description":"Customize company name, taxation policy, tax mode, and more.","options":{"layout":"Accordion","elementLabelProp":"channel","ipua":{"ipuaPanel":{"panelSubText":"Learn how to","panelLinkText":"customize tax calculation settings","panelContent":"/bundle/usd1665121460439_usd1665121460439/page/myc1716306970603.html"}}},"elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Company name","scope":"#/properties/tax_calculation_obj/properties/company_code","options":{"optionList":True,"eventListener":"onCompanyInit"},"description":"Avalara company connected to your Adobe Commerce store."},{"type":"Control","label":"Taxation policy (store view)","scope":"#/properties/tax_calculation_obj/properties/tax_included","options":{"format":"radio"},"customRule":{"effect":"ENABLE","condition":{"scope":"#/properties/tax_calculation_obj/properties/tax_included_visibility","schema":{"const":True}}}},{"type":"infoPanel","scope":"#","options":{"alert":True,"className":"margin-bottom-xl","status":"warning","message":"For tax compliance reasons, once you save the settings for the first time, you will not be able to change the <b>Taxation Policy</b> again."}},{"type":"Control","label":"Tax mode (store view)","scope":"#/properties/tax_calculation_obj/properties/tax_mode","description":"Use Adobe Commerce to estimate tax. Avalara is not used to estimate tax, and no transactions are submitted to Avalara.","options":{"format":"radio"}},{"type":"Group","label":"Data mapping (store view)","scope":"#/properties/tax_calculation_obj/properties/data_mapping","elements":[{"type":"Control","label":"Shipping tax code (store view)","scope":"#/properties/tax_calculation_obj/properties/data_mapping/properties/shipping_tax_code","description":"Enter a shipping tax code for transactions at your store. If you don't enter a value, Avalara automatically assigns freight (FR020100) as the shipping tax code."},{"type":"Control","label":"Calculate tax on adjustment refund and adjustment fee with Avalara (store view)","scope":"#/properties/tax_calculation_obj/properties/data_mapping/properties/avatax_adjustment_taxes","description":"Allow Avalara to calculate tax for adjustment fees and refunds. Adobe Commerce doesn't calculate taxes for adjustment fees and refunds.","options":{"toggle":True,"trueStatusLabel":"On","falseStatusLabel":"Off"}}]}]}],"customRule":{"effect":"HIDE","condition":{"scope":"#/properties/tax_calculation_obj/properties/tax_calculation_visibility","schema":{"const":False}}}},{"type":"Control","scope":"#/properties/address_validation_obj","description":"Customize the enable address validation option.","options":{"layout":"Accordion","elementLabelProp":"channel","ipua":{"ipuaPanel":{"panelSubText":"Learn how to","panelLinkText":"customize address validation setting","panelContent":"/bundle/usd1665121460439_usd1665121460439/page/fwr1722335548814.html"}}},"label":"Validate addresses with Avalara","elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Validate addresses (store view)","scope":"#/properties/address_validation_obj/properties/address_validation_enabled","options":{"toggle":True,"trueStatusLabel":"On","falseStatusLabel":"Off"},"description":"Validate the addresses in the U.S. and Canada."}]}],"customRule":{"effect":"SHOW","condition":{"scope":"#","schema":{"required":["address_validation_obj"]}}}},{"type":"Control","scope":"#/properties/exemption_certificate_management_obj","description":"Customize exemption certificate options.","options":{"layout":"Accordion","elementLabelProp":"channel","ipua":{"ipuaPanel":{"panelSubText":"Learn how to","panelLinkText":"customize customer exemption setting","panelContent":"/bundle/usd1665121460439_usd1665121460439/page/iga1722335697674.html"}}},"label":"Customer exemptions","elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Enable exemption certificates (store view)","scope":"#/properties/exemption_certificate_management_obj/properties/enabled","description":"Add a link for customers to create or upload exemption certificates during checkout.","options":{"toggle":True,"trueStatusLabel":"On","falseStatusLabel":"Off"}}]}],"customRule":{"effect":"SHOW","condition":{"scope":"#","schema":{"required":["exemption_certificate_management_obj"]}}}},{"type":"Control","scope":"#/properties/transactions_outside_the_us_obj","description":"Customize business VAT ID options.","options":{"layout":"Accordion","elementLabelProp":"channel","ipua":{"ipuaPanel":{"panelSubText":"Learn how to","panelLinkText":"customize VAT ID setting","panelContent":"/bundle/usd1665121460439_usd1665121460439/page/lnb1722335808893.html"}}},"label":"VAT ID","elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Business VAT ID (store view)","scope":"#/properties/transactions_outside_the_us_obj/properties/use_business_identification_number","description":"Use VAT number/Tax value from customer records to calculate tax in Avalara. This value is sent as a business identification number to Avalara.","options":{"toggle":True,"trueStatusLabel":"Yes","falseStatusLabel":"No"}}]}],"customRule":{"effect":"SHOW","condition":{"scope":"#","schema":{"required":["transactions_outside_the_us_obj"]}}}},{"type":"Control","scope":"#/properties/one_way_items_sync","description":"Customize product sync options.","options":{"layout":"Accordion","elementLabelProp":"channel","ipua":{"ipuaPanel":{"panelSubText":"Learn how to","panelLinkText":"customize product sync settings","panelContent":"/bundle/usd1665121460439_usd1665121460439/page/xow1722336465402.html"}}},"label":"Product sync","elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Sync products with Avalara (store view)","scope":"#/properties/one_way_items_sync/properties/enabled","options":{"toggle":True,"trueStatusLabel":"On","falseStatusLabel":"Off"},"description":"Sync your product catalog in Adobe Commerce with the catalog you configured in the Avalara Portal. This is a one-way product sync from Adobe Commerce to Avalara."}]},{"type":"infoPanel","scope":"#","options":{"alert":True,"className":"margin-bottom-sm","status":"warning","message":"Product sync applies only to the default company that you've configured in your Avalara account. To sync products to a different company, change your default company in Avalara."},"customRule":{"effect":"HIDE","condition":{"scope":"#/properties/one_way_items_sync/properties/enabled","schema":{"const":False}}}}],"customRule":{"effect":"SHOW","condition":{"scope":"#","schema":{"required":["one_way_items_sync"]}}}},{"type":"Control","scope":"#/properties/error_logs","description":"Customize transaction logs, errors, and notification options.","options":{"layout":"Accordion","elementLabelProp":"channel","ipua":{"ipuaPanel":{"panelSubText":"Learn how to","panelLinkText":"customize error handling and timeout settings","panelContent":"/bundle/usd1665121460439_usd1665121460439/page/rcx1722335932877.html"}}},"label":"Error handling and timeout","elements":[{"type":"Group","label":"Error handling settings","scope":"#/properties/error_logs_obj/properties/error_settings_obj","description":"Customize error handling and timeout options.","elements":[{"type":"Control","label":"Error action (store view)","scope":"#/properties/error_logs_obj/properties/error_settings_obj/properties/error_action","description":"If there is an error when Avalara estimates tax, the extension uses Adobe Commerce tax rules. If Disable checkout and show error message is selected, the extension prevents users and admins from placing orders.","options":{"ipua":{"infotips":[{"parent":"label","iphId":"error_action","iphContent":"/bundle/ool1720100088814/page/szl1720100205873.html"}]}}},{"type":"Control","label":"Avalara API timeout (store view)","scope":"#/properties/error_logs_obj/properties/error_settings_obj/properties/avatax_timeout","description":"Enter the waiting time in seconds for Adobe Commerce to get a response from Avalara servers before concluding they aren't responding."}],"customRule":{"effect":"SHOW","condition":{"scope":"#/properties/error_logs_obj","schema":{"required":["error_settings_obj"]}}}},{"type":"Group","label":"Logging settings","scope":"#/properties/error_logs_obj/properties/logs_settings_obj","elements":[{"type":"Control","label":"Database log level (global)","scope":"#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_db_level","description":"'Warning' is recommended if you're connected to an Avalara production account."},{"type":"Control","label":"Database log detail (global)","scope":"#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_db_detail","description":"'Minimal' is recommended if you're connected to an Avalara production account."},{"type":"Control","label":"Database log record lifetime (global)","scope":"#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_db_lifetime","description":"Set the number of days for Avalara to keep your log records."},{"type":"Control","label":"Enable logging to file (global)","scope":"#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_enabled","options":{"toggle":True,"trueStatusLabel":"On","falseStatusLabel":"Off"},"description":"Create a log of API requests, responses, and errors for transactions. The log is saved in Adobe Commerce. It's useful when troubleshooting issues with transactions."},{"type":"Control","label":"File log level (global)","scope":"#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_level","description":"'Warning' is recommended if you’re connected to an Avalara production account.","customRule":{"effect":"HIDE","condition":{"scope":"#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_enabled","schema":{"const":False}}}},{"type":"Control","label":"File log detail (global)","scope":"#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_detail","description":"'Normal' is recommended if you’re connected to an Avalara production account.","customRule":{"effect":"HIDE","condition":{"scope":"#/properties/error_logs_obj/properties/logs_settings_obj/properties/logging_file_enabled","schema":{"const":False}}}}],"customRule":{"effect":"SHOW","condition":{"scope":"#/properties/error_logs_obj","schema":{"required":["logs_settings_obj"]}}}},{"type":"Group","label":"Queue processing settings","scope":"#/properties/error_logs_obj/properties/queue_settings_obj","elements":[{"type":"Control","label":"Queue processing type (global) ","scope":"#/properties/error_logs_obj/properties/queue_settings_obj/properties/queue_processing_type","options":{"format":"radio"}},{"type":"Control","label":"Enable queue admin notification (global)","scope":"#/properties/error_logs_obj/properties/queue_settings_obj/properties/queue_admin_notification_enabled","description":"Display notification at the top of any admin page if there are pending queue records waiting to be submitted to Avalara but no attempts have been made in the last 24 hours to submit them.","options":{"toggle":True,"trueStatusLabel":"On","falseStatusLabel":"Off"}},{"type":"Control","label":"Enable queue failure notification (global)","scope":"#/properties/error_logs_obj/properties/queue_settings_obj/properties/queue_failure_notification_enabled","description":"Display notification at the top of any admin page if there are transactions waiting to be submitted to Avalara and no attempts have been made to submit them in the last 24 hours.","options":{"toggle":True,"trueStatusLabel":"On","falseStatusLabel":"Off"}}],"customRule":{"effect":"SHOW","condition":{"scope":"#/properties/error_logs_obj","schema":{"required":["queue_settings_obj"]}}}}]}]}, 'a0n3300000Iokv5AAB': {'config': {"$schema":"http://json-schema.org/draft-07/schema#","$id":"http://example.com/schema","$defs":{"tax_calculation":{"type":"object","additionalProperties":False,"properties":{"wc_avatax_enable_tax_calculation":{"type":"boolean","default":True},"wc_avatax_record_calculations":{"type":"boolean","default":True},"wc_avatax_company_code":{"type":"string"},"wc_avatax_company_id":{"type":"number"},"wc_avatax_shipping_code":{"type":"string","default":"FR"}},"required":["wc_avatax_company_code","wc_avatax_company_id"]},"address_validation":{"additionalProperties":False,"type":"object","properties":{"wc_avatax_enable_address_validation":{"type":"boolean","default":True}}},"exemption_certificate_management":{"type":"object","additionalProperties":False,"properties":{"wc_avatax_enable_ecm":{"type":"boolean","default":True}}},"transactions_outside_the_us":{"type":"object","additionalProperties":False,"properties":{"wc_avatax_enable_vat":{"type":"boolean","default":True}}},"logs":{"type":"object","additionalProperties":False,"properties":{"wc_avatax_debug":{"type":"boolean","default":True}}}},"type":"object","properties":{"tax_calculation":{"$ref":"#/$defs/tax_calculation"},"address_validation":{"$ref":"#/$defs/address_validation"},"exemption_certificate_management":{"$ref":"#/$defs/exemption_certificate_management"},"transactions_outside_the_us":{"$ref":"#/$defs/transactions_outside_the_us"},"logs":{"$ref":"#/$defs/logs"}},"required":["tax_calculation"]}, 'layout': {"type":"VerticalLayout","elements":[{"type":"Control","label":"Tax calculation","scope":"#/properties/tax_calculation","options":{"layout":"Accordion","elementLabelProp":"channel"},"elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Enable tax calculation","scope":"#/properties/tax_calculation/properties/wc_avatax_enable_tax_calculation","options":{"toggle":True,"trueStatusLabel":"Yes","falseStatusLabel":"No"}},{"type":"Control","label":"Save transactions in Avalara for reporting","scope":"#/properties/tax_calculation/properties/wc_avatax_record_calculations","description":"Turn this on to save transactions in Avalara when an order status in WooCommerce is \"Payment received\", \"Processing,\" or \"Complete.\"","options":{"toggle":True,"trueStatusLabel":"Yes","falseStatusLabel":"No"},"customRule":{"effect":"SHOW","condition":{"scope":"#/properties/tax_calculation/properties/wc_avatax_enable_tax_calculation","schema":{"const":True}}}},{"type":"Control","label":"Company name","scope":"#/properties/tax_calculation/properties/wc_avatax_company_code","options":{"optionList":True,"eventListener":"onCompanyInit"},"customRule":{"effect":"SHOW","condition":{"scope":"#/properties/tax_calculation/properties/wc_avatax_enable_tax_calculation","schema":{"const":True}}}},{"type":"Control","label":"Calculate Colorado retail delivery fee","scope":"#/properties/tax_calculation/properties/wc_avatax_enable_co_rdf","description":"Turn this on to calculate the Colorado retail delivery fee on orders in Colorado. Not all businesses are required to collect the retail delivery fee.","options":{"toggle":True,"trueStatusLabel":"Yes","falseStatusLabel":"No"},"customRule":{"effect":"SHOW","condition":{"type":"AND","conditions":[{"scope":"#/properties/tax_calculation","schema":{"required":["wc_avatax_enable_co_rdf"]}},{"scope":"#/properties/tax_calculation/properties/wc_avatax_enable_tax_calculation","schema":{"const":True}}]}}},{"type":"Control","label":"Shipping tax code","scope":"#/properties/tax_calculation/properties/wc_avatax_shipping_code","description":"Set a default shipping tax code for transactions that are missing a shipping tax code. Avalara assigns the shipping tax code for a third-party common carrier (FR) if you don't enter a value.","customRule":{"effect":"SHOW","condition":{"scope":"#/properties/tax_calculation/properties/wc_avatax_enable_tax_calculation","schema":{"const":True}}}}]}]},{"type":"Control","scope":"#/properties/address_validation","options":{"layout":"Accordion","elementLabelProp":"channel"},"label":"Address validation","elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Enable address validation","scope":"#/properties/address_validation/properties/wc_avatax_enable_address_validation","description":"Turn this on to enable the Validate Address option. Customers can select it to validate and correct addresses in the U.S. and Canada.","options":{"toggle":True,"trueStatusLabel":"Yes","falseStatusLabel":"No"}}]}],"customRule":{"effect":"SHOW","condition":{"scope":"#","schema":{"required":["address_validation"]}}}},{"type":"Control","scope":"#/properties/exemption_certificate_management","options":{"layout":"Accordion","elementLabelProp":"channel"},"label":"Exemption certificate management","elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Enable exemption certificates","scope":"#/properties/exemption_certificate_management/properties/wc_avatax_enable_ecm","options":{"toggle":True,"trueStatusLabel":"Yes","falseStatusLabel":"No"}}]}],"customRule":{"effect":"SHOW","condition":{"scope":"#","schema":{"required":["exemption_certificate_management"]}}}},{"type":"Control","scope":"#/properties/transactions_outside_the_us","options":{"layout":"Accordion","elementLabelProp":"channel"},"label":"Transactions outside the US","elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Collect business VAT ID","scope":"#/properties/transactions_outside_the_us/properties/wc_avatax_enable_vat","description":"Turn this on to provide a place for customers to enter their business VAT ID during checkout.","options":{"toggle":True,"trueStatusLabel":"Yes","falseStatusLabel":"No"}}]}],"customRule":{"effect":"SHOW","condition":{"scope":"#","schema":{"required":["transactions_outside_the_us"]}}}},{"type":"Control","scope":"#/properties/logs","options":{"layout":"Accordion","elementLabelProp":"channel"},"label":"Logs","elements":[{"type":"VerticalLayout","elements":[{"type":"Control","label":"Enable logging","scope":"#/properties/logs/properties/wc_avatax_debug","description":"Turn this on to create a log of API requests, responses, and errors for transactions. The log is saved in WooCommerce. It's useful when troubleshooting issues with transactions.","options":{"toggle":True,"trueStatusLabel":"Yes","falseStatusLabel":"No"}}]}]}]}}}}))
        return {"connector_layout_configs": connector_layout_configs}